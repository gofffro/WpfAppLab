<Window x:Class="WpfApp1.IntegralProg.IntergralWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:oxy="http://oxyplot.org/wpf"
        mc:Ignorable="d"
        Title="IntegralProg - Вычисление определенного интеграла" 
        Height="800" Width="1100"
        WindowStartupLocation="CenterScreen"
        Closing="Window_Closing">

    <Window.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#ebf2fa" Offset="0.0" />
            <GradientStop Color="#e4edf6" Offset="0.6" />
            <GradientStop Color="#dae3f0" Offset="1.0" />
        </LinearGradientBrush>
    </Window.Background>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu -->
        <Menu Grid.Row="0">
            <MenuItem Header="Файл">
                <MenuItem Header="Рассчитать" Click="Calculate_Click"/>
                <MenuItem Header="Пошагово" Click="StartStepByStep_Click"/>
                <MenuItem Header="Следующий шаг" Click="NextStep_Click" Name="miNextStep"/>
                <MenuItem Header="Сбросить итерации" Click="ResetSteps_Click"/>
                <MenuItem Header="Очистить всё" Click="ClearAll_Click"/>
                <Separator/>
                <MenuItem Header="Выход" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="Настройки">
                <MenuItem Header="Автоматический выбор N" IsCheckable="True" IsChecked="False" 
                          Name="miAutoN" Click="AutoN_Click"/>
                <MenuItem Header="Показать сетку" IsCheckable="True" IsChecked="True" 
                          Name="miShowGrid" Click="ShowGrid_Click"/>
                <MenuItem Header="Рисовать разбиения" IsCheckable="True" IsChecked="True"
                          Name="miDrawPartitions" Click="DrawPartitions_Click"/>
                <Separator/>
                <MenuItem Header="Цвет графика функции">
                    <MenuItem Header="Синий" Click="ColorFunctionBlue_Click"/>
                    <MenuItem Header="Красный" Click="ColorFunctionRed_Click"/>
                    <MenuItem Header="Зеленый" Click="ColorFunctionGreen_Click"/>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="Справка">
                <MenuItem Header="Синтаксис функций" Click="Help_Click"/>
                <MenuItem Header="О методах" Click="AboutMethods_Click"/>
                <MenuItem Header="О программе" Click="AboutProgram_Click"/>
            </MenuItem>
        </Menu>

        <!-- Integral notation and function input -->
        <GroupBox Grid.Row="1" Header="Вычисление определенного интеграла" Margin="10,5" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Интеграл с пределами -->
                <Border Grid.Row="0" Grid.Column="0" Grid.RowSpan="3" 
                        BorderThickness="1" BorderBrush="#2196F3" 
                        Background="#E3F2FD" Padding="15,10" Margin="0,0,10,0">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <TextBox Name="txtB" Text="3.14159" Width="80" HorizontalAlignment="Center"
                                 TextAlignment="Center" FontSize="12" Margin="0,0,0,2"/>
                        <TextBlock Text="∫" FontSize="36" FontWeight="Bold" 
                                   Foreground="#2196F3" HorizontalAlignment="Center"/>
                        <TextBox Name="txtA" Text="0" Width="80" HorizontalAlignment="Center"
                                 TextAlignment="Center" FontSize="12" Margin="0,2,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Функция и dx -->
                <TextBlock Grid.Row="0" Grid.Column="1" Grid.RowSpan="3" 
                           Text="f(x)" FontSize="16" FontWeight="Bold" 
                           VerticalAlignment="Center" Margin="0,0,5,0"/>

                <TextBox Grid.Row="0" Grid.Column="2" Grid.RowSpan="3" 
                         Name="txtFunction" Text="sin(x)" 
                         FontSize="14" VerticalAlignment="Center" Height="40"
                         Margin="0,0,5,0" ToolTip="Введите математическое выражение функции"/>

                <TextBlock Grid.Row="0" Grid.Column="3" Grid.RowSpan="3" 
                           Text="dx" FontSize="16" FontWeight="Bold" 
                           VerticalAlignment="Center" Margin="0,0,20,0"/>

                <!-- Параметры интегрирования -->
                <StackPanel Grid.Row="0" Grid.Column="4" Grid.ColumnSpan="2" Orientation="Horizontal">
                    <Label Content="Точность ε:" Margin="5" VerticalAlignment="Center"/>
                    <TextBox Name="txtEpsilon" Text="0.0001" Width="80" Margin="5" 
                             ToolTip="Требуемая точность вычисления"/>

                    <Label Content="Макс. разбиений:" Margin="5,5,5,5" VerticalAlignment="Center"/>
                    <TextBox Name="txtN" Text="1000" Width="80" Margin="5" 
                             ToolTip="Максимальное количество разбиений"/>

                    <CheckBox Name="cbAutoN" Content="Авто N" Margin="10,0" VerticalAlignment="Center"
                              Checked="AutoNCheckBox_Checked" Unchecked="AutoNCheckBox_Unchecked"/>
                </StackPanel>

                <!-- Методы интегрирования -->
                <StackPanel Grid.Row="1" Grid.Column="4" Grid.ColumnSpan="2" 
                            Orientation="Horizontal" Margin="0,10">
                    <TextBlock Text="Методы:" Margin="5,0" VerticalAlignment="Center" 
                               FontWeight="Bold"/>

                    <CheckBox Name="cbRectLeft" Content="Прямоуг. (лев.)" Margin="10,0" 
                              ToolTip="Метод левых прямоугольников" IsChecked="True"/>
                    <CheckBox Name="cbRectRight" Content="Прямоуг. (прав.)" Margin="10,0"
                              ToolTip="Метод правых прямоугольников"/>
                    <CheckBox Name="cbRectMid" Content="Прямоуг. (сред.)" Margin="10,0"
                              ToolTip="Метод средних прямоугольников"/>

                    <CheckBox Name="cbTrapezoid" Content="Трапеций" Margin="10,0" IsChecked="True"
                              ToolTip="Метод трапеций"/>

                    <CheckBox Name="cbSimpson" Content="Симпсона" Margin="10,0" IsChecked="True"
                              ToolTip="Метод парабол (Симпсона)"/>
                </StackPanel>

                <!-- Кнопки управления -->
                <StackPanel Grid.Row="2" Grid.Column="4" Grid.ColumnSpan="2" 
                            Orientation="Horizontal" Margin="0,10">
                    <Button Name="btnCalculate" Content="Рассчитать" Margin="5,0" 
                            Width="120" Click="Calculate_Click" Background="#4CAF50" 
                            Foreground="White" FontWeight="Bold"
                            ToolTip="Выполнить вычисление интеграла"/>
                    <Button Name="btnStepByStep" Content="Пошагово" Margin="5,0" 
                            Width="100" Click="StartStepByStep_Click" 
                            ToolTip="Пошаговый режим вычисления"/>
                    <Button Name="btnNextStep" Content="Следующий шаг" Margin="5,0" 
                            Width="120" Click="NextStep_Click" IsEnabled="False" 
                            ToolTip="Следующий шаг в пошаговом режиме"/>
                    <Button Name="btnClear" Content="Очистить" Margin="5,0" 
                            Width="80" Click="ClearAll_Click" 
                            ToolTip="Очистить все поля и график"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- Results and Chart -->
        <Grid Grid.Row="2" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <!-- Chart -->
            <GroupBox Grid.Column="0" Header="График функции" Margin="0,0,5,0" Padding="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <oxy:PlotView Name="plotView" Grid.Row="0" Margin="0"/>
                    <TextBlock Grid.Row="1" Name="lblPlotWarning" Text="" 
                               Foreground="OrangeRed" FontSize="11" Margin="5,5,5,0"
                               TextWrapping="Wrap" HorizontalAlignment="Center"/>
                </Grid>
            </GroupBox>

            <!-- Results -->
            <GroupBox Grid.Column="1" Header="Результаты вычислений" Margin="5,0,0,0" Padding="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Прогресс бар -->
                    <ProgressBar Grid.Row="0" Name="progressBar" Height="20" Margin="0,0,0,10"
                                 Minimum="0" Maximum="100" Value="0" Visibility="Collapsed"/>

                    <TextBlock Grid.Row="0" Name="lblProgress" Text="" Margin="0,0,0,10" 
                               HorizontalAlignment="Center" FontWeight="Bold"
                               Visibility="Collapsed"/>

                    <!-- Информация о расчете -->
                    <Border Grid.Row="1" BorderBrush="#FF9800" BorderThickness="1" 
                            Background="#FFF3E0" Margin="0,0,0,10" Padding="8">
                        <StackPanel>
                            <TextBlock Text="Параметры расчета:" FontWeight="Bold" 
                                       Foreground="#F57C00" Margin="0,0,0,3"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Пределы: " FontWeight="SemiBold"/>
                                <TextBlock Name="tbBounds" Text="[0, π]"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Режим: " FontWeight="SemiBold"/>
                                <TextBlock Name="tbMode" Text="Фиксированное N"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Функция: " FontWeight="SemiBold"/>
                                <TextBlock Name="tbFunction" Text="sin(x)" TextWrapping="Wrap"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Результаты методов -->
                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                        <StackPanel Name="spResults">
                            <TextBlock Text="Результаты методов:" FontWeight="Bold" 
                                       Margin="0,0,0,10" FontSize="14"/>

                            <!-- Результаты будут добавляться динамически -->
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Информация о шагах -->
                    <Border Grid.Row="3" BorderBrush="LightGray" BorderThickness="1" 
                            Margin="0,10,0,0" Padding="8" Background="#F5F5F5">
                        <StackPanel>
                            <TextBlock Name="lblStepInfo" Text="Готов к расчету" 
                                       FontWeight="Bold" Foreground="DarkBlue"/>
                            <TextBlock Name="lblIterationInfo" Text="" FontSize="11" 
                                       Foreground="Gray" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </GroupBox>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3" Background="#E3F2FD">
            <StatusBarItem>
                <TextBlock Name="lblStatus" Text="Готов к работе"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Name="lblTime" Text="Время: 0 мс"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Name="lblIntegralInfo" Text="∫[a,b] f(x)dx"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Name="lblCurrentMode" Text="Режим: фиксированное N"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Name="lblDrawingInfo" Text="Рисование: включено"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>